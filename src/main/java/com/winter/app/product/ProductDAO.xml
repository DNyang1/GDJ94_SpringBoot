<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.winter.app.product.ProductDAO">

    <!-- 검색 공통 SQL -->
    <sql id="search">
        <if test="kind == 'k1'">
            WHERE product_title LIKE CONCAT('%', #{search}, '%')
        </if>

        <if test="kind == 'k2'">
            WHERE product_name LIKE CONCAT('%', #{search}, '%')
        </if>

        <if test="kind == 'k3'">
            WHERE product_category LIKE CONCAT('%', #{search}, '%')
        </if>
    </sql>

    <select id="detail" resultType="ProductDTO" parameterType="ProductDTO">
        SELECT 
            product_num      AS pNum,
            product_title    AS pTitle,
            product_name     AS pName,
            product_category AS pCate,
            product_rate     AS pRate,
            product_sale     AS pSale
        FROM product
        WHERE product_num = #{pNum}
    </select>

    <select id="count" resultType="Long" parameterType="Pager">
        SELECT COUNT(product_num)
        FROM product
        <include refid="search"/>
    </select>

    <select id="list" resultType="ProductDTO" parameterType="Pager">
        SELECT
            product_num      AS pNum,
            product_title    AS pTitle,
            product_name     AS pName,
            product_category AS pCate,
            product_rate     AS pRate,
            product_sale     AS pSale
        FROM product
        <include refid="search"/>
        ORDER BY product_num DESC
        LIMIT #{startNum}, #{perPage}
    </select>

    <insert id="add" parameterType="ProductDTO" useGeneratedKeys="true" keyProperty="pNum">
        INSERT INTO product
        (product_title, product_name, product_category, product_rate, product_sale)
        VALUES
        (#{pTitle}, #{pName}, #{pCate}, #{pRate}, #{pSale})
    </insert>

    <update id="update" parameterType="ProductDTO">
        UPDATE product
        SET
            product_title    = #{pTitle},
            product_name     = #{pName},
            product_category = #{pCate},
            product_rate     = #{pRate},
            product_sale     = #{pSale}
        WHERE product_num = #{pNum}
    </update>

    <delete id="delete" parameterType="ProductDTO">
        DELETE FROM product
        WHERE product_num = #{pNum}
    </delete>

</mapper>
